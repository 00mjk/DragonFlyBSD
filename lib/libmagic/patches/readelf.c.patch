$DragonFly: src/lib/libmagic/patches/Attic/readelf.c.patch,v 1.1 2005/06/01 15:09:11 joerg Exp $

--- readelf.c	18 Dec 2004 17:18:06 -0000	1.1
+++ readelf.c	1 Jun 2005 13:53:21 -0000
@@ -487,6 +487,19 @@
 		return size;
 	}
 
+	if (namesz == 10 && strcmp((char *)&nbuf[noff], "DragonFly") == 0 &&
+	    nh_type == NT_DRAGONFLY_VERSION && descsz == 4) {
+		if (file_printf(ms, ", for DragonFly") == -1)
+			return size;
+		uint32_t desc;
+		(void)memcpy(&desc, &nbuf[doff], sizeof(desc));
+		desc = getu32(swap, desc);
+		if (file_printf(ms, " %d.%d.%d", desc / 100000,
+		    desc / 10000 % 10, desc % 10000) == -1)
+			return size;
+		return size;
+	}
+
 	/*
 	 * Sigh.  The 2.0.36 kernel in Debian 2.1, at
 	 * least, doesn't correctly implement name
