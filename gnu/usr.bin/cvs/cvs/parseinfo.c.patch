$DragonFly: src/gnu/usr.bin/cvs/cvs/Attic/parseinfo.c.patch,v 1.4 2005/12/07 01:16:30 corecode Exp $
Index: src/parseinfo.c
===================================================================
RCS file: /space/cvs/dragonfly/src/contrib/cvs-1.12/src/parseinfo.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 parseinfo.c
--- src/parseinfo.c	7 Dec 2005 00:15:19 -0000	1.1.1.1
+++ src/parseinfo.c	7 Dec 2005 01:04:02 -0000
@@ -384,6 +384,7 @@
     size_t len;
     char *p;
     struct config *retval;
+    int rescan = 0;
     /* PROCESSING	Whether config keys are currently being processed for
      *			this root.
      * PROCESSED	Whether any keys have been processed for this root.
@@ -429,6 +430,7 @@
 
     retval = new_config ();
 
+again:
     fp_info = CVS_FOPEN (infopath, "r");
     if (!fp_info)
     {
@@ -553,9 +555,11 @@
 	    readBool (infopath, "SystemAuth", p, &dummy);
 	}
 #endif
-	else if (strcmp (line, "LocalKeyword") == 0)
+	else if (strcmp (line, "LocalKeyword") == 0 ||
+		 strcmp (line, "tag") == 0)
 	    RCS_setlocalid (infopath, ln, &retval->keywords, p);
-	else if (strcmp (line, "KeywordExpand") == 0)
+	else if (strcmp (line, "KeywordExpand") == 0 ||
+		 strcmp (line, "tagexpand") == 0)
 	    RCS_setincexc (&retval->keywords, p);
 	else if (strcmp (line, "PreservePermissions") == 0)
 	{
@@ -719,5 +723,12 @@
     if (freeinfopath) free (freeinfopath);
     if (buf) free (buf);
 
+    if (path == NULL && !rescan++) {
+	infopath = freeinfopath =
+	    Xasprintf ("%s/%s/%s", cvsroot, CVSROOTADM, CVSROOTADM_OPTIONS);
+	buf = NULL;
+	goto again;
+    }
+
     return retval;
 }
